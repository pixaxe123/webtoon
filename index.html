<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>웹툰 추천</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
  h1 { text-align: center; }
  .search-bar { text-align: center; margin-bottom: 15px; position: relative; display: inline-block; }
  input[type="text"] { padding: 8px; width: 300px; border-radius: 5px; border: 1px solid #ccc; }
  .autocomplete { position: absolute; background: white; border: 1px solid #ccc; width: 300px; max-height: 150px; overflow-y: auto; z-index: 10; }
  .autocomplete div { padding: 5px; cursor: pointer; }
  .autocomplete div:hover { background: #eee; }
  .tags-container { text-align: center; margin-bottom: 15px; }
  .tag { display: inline-block; background: #ddd; padding: 5px 10px; margin: 3px; border-radius: 15px; cursor: pointer; transition: 0.2s; }
  .tag:hover { background: #bbb; }
  .tag.selected { background: #3498db; color: white; }
  .selected-tags-container { text-align: center; margin-bottom: 10px; }
  .selected-tag { display: inline-flex; align-items: center; background: #3498db; color: white; padding: 5px 10px; margin: 3px; border-radius: 15px; }
  .remove-tag { margin-left: 5px; cursor: pointer; font-weight: bold; }
  .webtoon-list { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
  .webtoon-card { background: white; padding: 15px; width: 220px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .webtoon-card h3 { margin: 0 0 10px; font-size: 18px; }
  .webtoon-card a { text-decoration: none; color: #3498db; }
  .author { color: #2c3e50; font-weight: bold; cursor: pointer; }
  .card-tags { margin-top: 8px; }
  .card-tags .tag { background: #eee; }
</style>
</head>
<body>

<h1>웹툰 추천</h1>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="태그 또는 작가 검색..." oninput="showSuggestions(); applyFilters();">
  <div class="autocomplete" id="autocompleteBox"></div>
</div>

<!-- 선택된 태그 표시 -->
<div class="selected-tags-container" id="selectedTags"></div>

<!-- 랜덤 태그 -->
<div class="tags-container" id="randomTags"></div>

<div class="webtoon-list" id="webtoonList"></div>

<script>
let webtoons = [];
let allTags = [];
let selectedTags = [];

// 데이터 불러오기
fetch('webtoons.json')
  .then(res => res.json())
  .then(data => {
    webtoons = data;
    allTags = [...new Set(webtoons.flatMap(w => [...w.tags, w.author, w.title]))];
    displayWebtoons(webtoons);
    showRandomTags();
  });

function displayWebtoons(list) {
  const container = document.getElementById('webtoonList');
  container.innerHTML = '';
  list.forEach(w => {
    const card = document.createElement('div');
    card.className = 'webtoon-card';
    card.innerHTML = `
      <h3><a href="${w.link}" target="_blank">${w.title}</a></h3>
      <div class="author" onclick="selectAuthor('${w.author}')">${w.author}</div>
      <div class="card-tags">
        ${w.tags.map(t => `<span class="tag" onclick="toggleTag('${t}')">${t}</span>`).join('')}
      </div>
    `;
    container.appendChild(card);
  });
}

function toggleTag(tag) {
  if (selectedTags.includes(tag)) {
    selectedTags = selectedTags.filter(t => t !== tag);
  } else {
    selectedTags.push(tag);
  }
  updateTagSelectionUI();
  applyFilters();
}

function updateTagSelectionUI() {
  // 태그 버튼 색상 변경
  document.querySelectorAll('.tag').forEach(el => {
    if (selectedTags.includes(el.textContent)) {
      el.classList.add('selected');
    } else {
      el.classList.remove('selected');
    }
  });

  // 선택된 태그 목록 표시
  const selectedContainer = document.getElementById('selectedTags');
  selectedContainer.innerHTML = selectedTags
    .map(tag => `<span class="selected-tag">${tag} <span class="remove-tag" onclick="removeTag('${tag}')">×</span></span>`)
    .join('');
}

function removeTag(tag) {
  selectedTags = selectedTags.filter(t => t !== tag);
  updateTagSelectionUI();
  applyFilters();
}

function selectAuthor(author) {
  if (!selectedTags.includes(author)) {
    selectedTags.push(author);
  }
  document.getElementById('searchInput').value = author;
  updateTagSelectionUI();
  applyFilters();
}

function applyFilters() {
  const keyword = document.getElementById('searchInput').value.toLowerCase();
  const filtered = webtoons.filter(w => {
    const matchesKeyword =
      !keyword ||
      w.tags.some(tag => tag.toLowerCase().includes(keyword)) ||
      w.author.toLowerCase().includes(keyword) ||
      w.title.toLowerCase().includes(keyword);

    const matchesTags =
      selectedTags.length === 0 || selectedTags.every(t => w.tags.includes(t) || w.author === t || w.title === t);

    return matchesKeyword && matchesTags;
  });
  displayWebtoons(filtered);
  updateTagSelectionUI();
}

function showSuggestions() {
  const input = document.getElementById('searchInput').value.toLowerCase();
  const box = document.getElementById('autocompleteBox');
  box.innerHTML = '';
  if (!input) return;
  
  const suggestions = allTags.filter(tag => tag.toLowerCase().includes(input)).slice(0, 8);
  suggestions.forEach(s => {
    const div = document.createElement('div');
    div.textContent = s;
    div.onclick = () => {
      document.getElementById('searchInput').value = s;
      if (!selectedTags.includes(s)) selectedTags.push(s);
      updateTagSelectionUI();
      applyFilters();
      box.innerHTML = '';
    };
    box.appendChild(div);
  });
}

function showRandomTags() {
  const randomTags = [...new Set(webtoons.flatMap(w => w.tags))]
    .sort(() => 0.5 - Math.random()).slice(0, 8);
  document.getElementById('randomTags').innerHTML = randomTags
    .map(tag => `<span class="tag" onclick="toggleTag('${tag}')">${tag}</span>`).join('');
}
</script>

</body>
</html>
